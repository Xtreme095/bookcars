# 3.1 Analytics & Reporting Dashboard

## Overview

Comprehensive analytics and reporting system for administrators and suppliers to track business performance, revenue, bookings, and key metrics with visual dashboards.

## Features

### For Administrators
- Platform-wide revenue tracking
- All bookings and trends
- Supplier performance comparison
- Commission analytics
- Customer acquisition metrics
- Most popular vehicles/locations
- Peak booking periods
- Revenue projections

### For Suppliers
- Supplier-specific revenue
- Booking statistics
- Vehicle utilization rates
- Average booking value
- Customer ratings breakdown
- Commission paid
- Fleet performance
- Occupancy rates

### For Customers
- Personal booking history
- Spending analysis
- Loyalty points earned
- Favorite vehicles/locations

## Key Metrics (KPIs)

1. **Revenue Metrics**
   - Total revenue
   - Revenue by period (day/week/month/year)
   - Revenue by supplier
   - Revenue by location
   - Revenue by vehicle type
   - Average booking value

2. **Booking Metrics**
   - Total bookings
   - Booking status distribution
   - Cancellation rate
   - Booking conversion rate
   - Average booking duration
   - Bookings by vehicle type

3. **Vehicle Metrics**
   - Utilization rate (% time booked)
   - Revenue per vehicle
   - Most booked vehicles
   - Idle vehicles
   - Maintenance downtime

4. **Customer Metrics**
   - Total customers
   - New customers (by period)
   - Repeat customer rate
   - Customer lifetime value
   - Average bookings per customer

5. **Supplier Metrics**
   - Revenue per supplier
   - Commission per supplier
   - Average vehicle utilization
   - Customer satisfaction score
   - Response time to bookings

## Dashboard Components

### 1. Overview Dashboard
- KPI cards (revenue, bookings, customers, vehicles)
- Revenue trend chart (line graph)
- Booking status pie chart
- Top 5 vehicles table
- Recent bookings list

### 2. Revenue Analytics
- Revenue over time (line/bar chart)
- Revenue by supplier (bar chart)
- Revenue by location (map or bar chart)
- Revenue by vehicle type (pie chart)
- Commission breakdown

### 3. Booking Analytics
- Booking trends (line chart)
- Booking status distribution (pie chart)
- Booking duration distribution (histogram)
- Booking by day of week (bar chart)
- Peak booking hours (heatmap)

### 4. Vehicle Analytics
- Vehicle utilization (horizontal bar chart)
- Revenue per vehicle (bar chart)
- Vehicle availability calendar
- Maintenance schedule timeline
- Idle vehicle alerts

### 5. Customer Analytics
- Customer acquisition trend (line chart)
- Repeat customer percentage
- Customer segments (new vs returning)
- Average booking value by customer
- Customer satisfaction scores

### 6. Export & Reports
- Export to CSV
- Export to PDF
- Schedule automated reports
- Custom date range selection
- Email reports

## Database Schema

### AnalyticsSummary Model
```typescript
{
  date: Date  // Daily summary
  type: 'daily' | 'weekly' | 'monthly'

  // Revenue
  totalRevenue: number
  platformCommission: number
  supplierEarnings: number

  // Bookings
  totalBookings: number
  confirmedBookings: number
  paidBookings: number
  cancelledBookings: number

  // Customers
  totalCustomers: number
  newCustomers: number
  repeatCustomers: number

  // Vehicles
  totalVehicles: number
  availableVehicles: number
  bookedVehicles: number

  // Breakdown by supplier
  bySupplier: [{
    supplier: ObjectId
    revenue: number
    bookings: number
    commission: number
  }]

  // Breakdown by location
  byLocation: [{
    location: ObjectId
    bookings: number
    revenue: number
  }]

  // Breakdown by vehicle type
  byVehicleType: [{
    type: string
    bookings: number
    revenue: number
  }]

  createdAt: Date
}
```

## API Endpoints

### GET /api/analytics/overview
Get overview dashboard data

**Query Parameters:**
- `startDate` (optional): Start date for range
- `endDate` (optional): End date for range
- `supplierId` (optional): Filter by supplier

**Response:**
```json
{
  "kpis": {
    "totalRevenue": 150000,
    "totalBookings": 450,
    "totalCustomers": 320,
    "totalVehicles": 85
  },
  "revenueTrend": [
    {"date": "2024-12-01", "revenue": 5000},
    {"date": "2024-12-02", "revenue": 5500}
  ],
  "bookingStatus": {
    "confirmed": 120,
    "paid": 280,
    "cancelled": 50
  }
}
```

### GET /api/analytics/revenue
Get detailed revenue analytics

### GET /api/analytics/bookings
Get booking analytics

### GET /api/analytics/vehicles
Get vehicle utilization analytics

### GET /api/analytics/customers
Get customer analytics

### GET /api/analytics/suppliers
Get supplier performance analytics (Admin only)

### POST /api/analytics/export
Export analytics data

**Request Body:**
```json
{
  "format": "csv" | "pdf",
  "type": "revenue" | "bookings" | "vehicles",
  "startDate": "2024-01-01",
  "endDate": "2024-12-31",
  "supplierId": "optional"
}
```

## Frontend Components

### React Components
1. `DashboardLayout` - Overall dashboard layout
2. `KPICard` - Individual KPI card widget
3. `RevenueChart` - Revenue trend line chart
4. `BookingStatusChart` - Booking status pie chart
5. `VehicleUtilizationChart` - Vehicle utilization bar chart
6. `TopVehiclesTable` - Top performing vehicles table
7. `DateRangeFilter` - Date range picker
8. `ExportButton` - Export data button
9. `AnalyticsGrid` - Responsive grid layout
10. `ChartWrapper` - Common chart wrapper with loading states

### Chart Library
Use **Recharts** or **Chart.js** for data visualization

## Implementation Steps

### Backend (Week 7, Days 1-2)
1. ✅ Create AnalyticsSummary model
2. ✅ Create analytics aggregation utilities
3. ✅ Implement analytics endpoints
4. ✅ Create daily aggregation cron job
5. ✅ Add export functionality

### Frontend - Admin (Week 7, Days 3-4)
1. ⏳ Create dashboard layout
2. ⏳ Implement KPI cards
3. ⏳ Add revenue charts
4. ⏳ Add booking charts
5. ⏳ Add vehicle utilization charts
6. ⏳ Implement date range filter
7. ⏳ Add export functionality

### Frontend - Supplier (Week 7, Day 5)
1. ⏳ Create supplier-specific dashboard
2. ⏳ Filter analytics by supplier
3. ⏳ Show supplier performance metrics

## Testing

- Unit tests for aggregation logic
- Integration tests for API endpoints
- E2E tests for dashboard interactions
- Performance tests for large datasets
- Export functionality tests

## Performance Optimization

1. **Aggregation Pipeline**: Use MongoDB aggregation for efficient queries
2. **Caching**: Cache daily summaries (Redis)
3. **Indexing**: Add indexes on date, supplier, booking fields
4. **Pagination**: Paginate large result sets
5. **Background Jobs**: Run heavy aggregations as background jobs

## Security

- Suppliers can only see their own analytics
- Admins can see all analytics
- Customers can see personal stats only
- Validate date ranges
- Rate limit export endpoints

## Success Criteria

- ✅ All KPIs display accurately
- ✅ Charts load in < 2 seconds
- ✅ Data updates in real-time (or near real-time)
- ✅ Export works for CSV and PDF
- ✅ Responsive design works on all screen sizes
- ✅ No performance degradation with 10,000+ bookings

## Future Enhancements

- Predictive analytics (ML-based forecasting)
- Custom dashboard widgets
- Real-time streaming updates
- Advanced filtering and segmentation
- Automated insight notifications
- Mobile analytics app
