# Phase 1.3: EUR Currency Implementation

**Status:** üî¥ Not Started
**Priority:** P0 - CRITICAL
**Duration:** 3 days
**Started:** Not started
**Completed:** Not completed

---

## üìã OVERVIEW

Croatia adopted the Euro (EUR) on January 1, 2023, replacing the Croatian Kuna (HRK). All pricing, payments, and financial transactions must use EUR.

**Fixed conversion rate:** 1 EUR = 7.53450 HRK

---

## üéØ OBJECTIVES

1. Set EUR as default currency
2. Remove all HRK references
3. Update currency formatting to Croatian locale
4. Configure payment gateways for EUR
5. Set Croatian VAT (PDV) at 25%
6. Update all language files

---

## ‚öôÔ∏è CONFIGURATION CHANGES

### Backend Configuration

**File:** `backend/src/config/env.config.ts`

```typescript
// Add currency constants
export const DEFAULT_CURRENCY = 'EUR'
export const CURRENCY_SYMBOL = '‚Ç¨'
export const SUPPORTED_CURRENCIES = ['EUR', 'USD', 'GBP'] // For future expansion
export const VAT_RATE = 25 // Croatian PDV (VAT) rate: 25%
export const CURRENCY_LOCALE = 'hr-HR' // Croatian locale

// Currency formatter
export function formatCurrency(amount: number, currency = 'EUR'): string {
  return new Intl.NumberFormat('hr-HR', {
    style: 'currency',
    currency: currency,
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  }).format(amount)
}

// Example output: 45,00 ‚Ç¨
```

---

## üóÑÔ∏è DATABASE MIGRATION

### Migrate Existing Prices

**File:** `backend/scripts/migrate-currency-to-eur.ts`

If database has any HRK prices, convert to EUR:

```typescript
async function migrateCurrencyToEUR() {
  const HRK_TO_EUR = 7.53450

  // Update all cars with HRK pricing
  await Car.updateMany(
    { currency: 'HRK' },
    [
      {
        $set: {
          dailyPrice: { $divide: ['$dailyPrice', HRK_TO_EUR] },
          weeklyPrice: { $divide: ['$weeklyPrice', HRK_TO_EUR] },
          monthlyPrice: { $divide: ['$monthlyPrice', HRK_TO_EUR] },
          deposit: { $divide: ['$deposit', HRK_TO_EUR] },
          // ... convert all price fields
          currency: 'EUR'
        }
      }
    ]
  )

  // Update bookings
  await Booking.updateMany(
    { currency: 'HRK' },
    [
      {
        $set: {
          price: { $divide: ['$price', HRK_TO_EUR] },
          currency: 'EUR'
        }
      }
    ]
  )

  console.log('Migration complete: All prices converted to EUR')
}
```

---

## üí≥ PAYMENT GATEWAY CONFIGURATION

### Stripe

**File:** `backend/src/payment/stripe.ts`

```typescript
// Set EUR as default currency
const paymentIntent = await stripe.paymentIntents.create({
  amount: Math.round(price * 100), // Amount in cents
  currency: 'eur',
  // ...
})

const session = await stripe.checkout.sessions.create({
  payment_intent_data: {
    currency: 'eur'
  },
  // ...
})
```

### PayPal

**File:** `backend/src/payment/paypal.ts`

```typescript
const order = await paypal.orders.create({
  purchase_units: [{
    amount: {
      currency_code: 'EUR',
      value: price.toFixed(2)
    }
  }]
})
```

---

## üé® FRONTEND FORMATTING

### Currency Formatter Utility

**File:** `frontend/src/utils/currency.ts`

```typescript
export function formatPrice(price: number): string {
  return new Intl.NumberFormat('hr-HR', {
    style: 'currency',
    currency: 'EUR',
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  }).format(price)
}

// Usage in components:
<Price>{formatPrice(car.dailyPrice)}</Price>
// Output: 45,00 ‚Ç¨
```

### Admin Formatter

**File:** `admin/src/utils/currency.ts`

Same implementation as frontend.

---

## üåç LANGUAGE FILE UPDATES

Update all language files with EUR references:

### English
```typescript
CURRENCY: 'EUR'
CURRENCY_SYMBOL: '‚Ç¨'
PRICE_PER_DAY_EUR: 'Price per day (‚Ç¨)'
DEPOSIT_EUR: 'Deposit (‚Ç¨)'
TOTAL_EUR: 'Total (‚Ç¨)'
VAT_RATE: 'VAT (25%)'
```

### Croatian
```typescript
CURRENCY: 'EUR'
CURRENCY_SYMBOL: '‚Ç¨'
PRICE_PER_DAY_EUR: 'Cijena po danu (‚Ç¨)'
DEPOSIT_EUR: 'Polog (‚Ç¨)'
TOTAL_EUR: 'Ukupno (‚Ç¨)'
VAT_RATE: 'PDV (25%)'
```

### French
```typescript
CURRENCY: 'EUR'
CURRENCY_SYMBOL: '‚Ç¨'
PRICE_PER_DAY_EUR: 'Prix par jour (‚Ç¨)'
DEPOSIT_EUR: 'Caution (‚Ç¨)'
TOTAL_EUR: 'Total (‚Ç¨)'
VAT_RATE: 'TVA (25%)'
```

### Spanish
```typescript
CURRENCY: 'EUR'
CURRENCY_SYMBOL: '‚Ç¨'
PRICE_PER_DAY_EUR: 'Precio por d√≠a (‚Ç¨)'
DEPOSIT_EUR: 'Dep√≥sito (‚Ç¨)'
TOTAL_EUR: 'Total (‚Ç¨)'
VAT_RATE: 'IVA (25%)'
```

---

## üìù IMPLEMENTATION CHECKLIST

### Day 1: Backend
- [ ] Add currency constants to env.config.ts
- [ ] Create formatCurrency utility
- [ ] Update Stripe integration to EUR
- [ ] Update PayPal integration to EUR
- [ ] Create migration script (if needed)
- [ ] Run migration on development database

### Day 2: Frontend & Admin
- [ ] Create currency formatter utilities
- [ ] Update all price displays to use formatter
- [ ] Update all language files
- [ ] Remove HRK references
- [ ] Update currency inputs/selectors
- [ ] Test currency display in all components

### Day 3: Testing & Verification
- [ ] Test Stripe checkout with EUR
- [ ] Test PayPal checkout with EUR
- [ ] Verify all prices display correctly
- [ ] Check Croatian locale formatting
- [ ] Test on different devices/browsers
- [ ] Update documentation

---

## ‚úÖ VERIFICATION CHECKLIST

- [ ] All prices display in EUR format: "45,00 ‚Ç¨"
- [ ] Stripe processes payments in EUR
- [ ] PayPal processes payments in EUR
- [ ] No HRK references anywhere in codebase
- [ ] Croatian locale formatting works correctly
- [ ] Decimal separator is comma (,) not period (.)
- [ ] Thousands separator is period (.) not comma (,)
- [ ] VAT/PDV correctly calculated at 25%

---

## üìä CROATIAN NUMBER FORMATTING

**Important:** Croatian locale uses different separators than English:

- **Decimal separator:** Comma (,)
- **Thousands separator:** Period (.) or space

**Examples:**
- English: 1,234.56 ‚Ç¨
- Croatian: 1.234,56 ‚Ç¨ or 1 234,56 ‚Ç¨

**Our format:** Using `hr-HR` locale automatically handles this.

---

## üö® CRITICAL NOTES

1. **Croatia uses EUR since January 1, 2023** - No more HRK
2. **Croatian VAT (PDV)** is 25%
3. **IBAN format:** HR + 19 digits
4. **Locale:** Use `hr-HR` for all Croatian formatting
5. **Payment gateways:** Must be configured for EUR

---

## üìö FILES TO CREATE/MODIFY

### New Files
- `backend/scripts/migrate-currency-to-eur.ts`
- `frontend/src/utils/currency.ts`
- `admin/src/utils/currency.ts`

### Modified Files
- `backend/src/config/env.config.ts`
- `backend/src/payment/stripe.ts`
- `backend/src/payment/paypal.ts`
- All language files (en.ts, fr.ts, es.ts, hr.ts)
- All components displaying prices

---

## üîÑ STATUS LOG

| Date | Status | Notes |
|------|--------|-------|
| 2024-12-24 | Not Started | Documentation created |
